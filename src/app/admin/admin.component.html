<div class="container-fluid-lg bg-opprtunity paddingAll">
    <div class="row">
        <div class="dashboard_heading col-sm-12 ">
            <h3>Manage Users {{'('+userResources?.total+')'}}</h3>
        </div>
        <!-- prgress bar section -->
        <div class="col-sm-12 container_box">
            <mat-card>
                <mat-card-content>
                    <div class="row">
                        <!-- <div class="col-sm-2 recources-container">
                            <span class="recources">{{userResources?.total}} - Resources</span>
                            <span>|</span>
                        </div> -->
                        
                        <div class="col-sm-1">
                            <span class="recources">{{userResources?.activeUsers}} - Active</span>
                        </div>
                        <div class="col-sm-4">
                            <div class="d-flex align-items-center gap-2 display_fs">
                                <div class="progress admin_prgres">
                                    <div class="progress-bar progress-bar-success non-fpduser" [style.width]="userResources?.activeUserPercentage+'%'" style="font-weight: 400; font-size: 10px; cursor:pointer; padding: 0 7px" role="progressbar" #tooltip="matTooltip" matTooltipClass="bg-light text-dark border border-info"
                                        matTooltip="Active Users {{userResources?.activeUserPercentage+'%'}}" matTooltipPosition="above">
                                        {{userResources?.activeUserPercentage+'%'}}
                                    </div>
                                    <div  class="progress-bar progress-bar-warning fpd_user" [style.width]="userResources?.inactiveUserPercentage+ 7 +'%'" style="font-weight: 400; font-size: 10px;cursor:pointer; padding: 0 7px" role="progressbar" #tooltip="matTooltip"
                                        matTooltipClass="bg-light text-dark border border-info" matTooltip="Inactive Users {{userResources?.inactiveUserPercentage+'%'}}" matTooltipPosition="above">
                                        {{userResources?.inactiveUserPercentage+'%'}}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="d-flex align-items-center gap-3 fw-bold display_fs">
                                <span class="recources">{{userResources?.inactiveUsers}} - Inactive</span>
                            </div>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
        <!-- resources  -->
        <div class="col-sm-12">
            <div class="row align-items-center">
                <div class="col-lg-10 col-md-12 col-sm-12 col-12 align-items-center">
                    <div class="row">
                        <div class="resource_head col-sm-6 col-md-3 col-lg-2 my-3 admin-search-by">
                            <h3>Search By :</h3>
                        </div>
                        <div class="col-sm-6 col-md-4 col-lg-3 my-3 ">
                            <label class="visually-hidden select-box fs" for="inlineFormSelectPref"></label>
                            <select class="select" (change)="filterBasedOn($event)">
                        <option value="All" selected>All</option>
                        <option value="name">Name</option>
                        <option value="userRoleDataCSV">Role</option>
                        <option value="state">State</option>
                        <option value="mobile">Phone</option>
                        <option value="emailAddress">Email</option>
                        <option value="status">Status</option>
                        <option value="userTypeName">User Type</option>
                        <option value="prevetting">Prevetting</option>
                        <option value="i_Am_Interested_In_The_Following_Assignments">Iâ€™m Interested In</option>
                        <option value="adjuster_Licenses">Licensed States</option>
                        <option value="residential_Property_Field">Residential Property Field</option>
                        <option value="residential_Property_Desk">Residential Property Desk</option>
                        <option value="commercial_Property_Field">Commercial Property Field</option>
                        <option value="commercial_Property_Desk">Commercial Property Desk</option>
                        <option value="casualty">Casualty</option>
                        <option value="fileTrac">FileTrac</option>
                        <option value="clickClaims">Click Claims</option>
                        <option value="xactimate_Estimating">Xactimate Estimating</option>
                        <option value="what_Type_Of_Claims_Would_You_Prefer_To_Be_Assigned">What type of claims would you prefer to be assigned?</option>
                    </select>
                        </div>
                <div class="col-sm-12 col-md-4 col-lg-3 my-3 item">
                    <input class="form-control" type="search" placeholder="Search" aria-label="Search"  #input [(ngModel)]="searchString" (keydown.enter)="applyFilter()" >
                    <!-- <mat-form-field>
                        <mat-label>
                            <mat-icon>search</mat-icon>
                        </mat-label>
                        <input matInput [(ngModel)]="searchString" (keydown.enter)="applyFilter()" placeholder="Ex. Mia" #input class="w-100">
                    </mat-form-field> -->

                </div>
                 <div class="col-lg-1 col-sm-12 col-md-12 col-12 my-3 admin-search-by">
                            <div class="add_button text-end">
                                <button mat-raised-button class="bg-greendark text-light" (click)="applyFilter()"><mat-icon>search</mat-icon> Search</button>
                            </div>
                </div>
                <div class="col-lg-1 col-sm-12 col-md-12 col-12 my-3 admin-search-by">
                    <button mat-icon-button [matMenuTriggerFor]="menu" #menuTrigger="matMenuTrigger"  (click)="menuTrigger.openMenu(); $event.stopPropagation()" aria-label="Example icon-button with a menu">
                        <mat-icon class="filter" [ngClass]="{'applied-filter': isFilterApplied}" #tooltip="matTooltip" matTooltipClass="bg-light text-dark border border-info" matTooltip="Advance Filters"
                        matTooltipPosition="above">filter_list</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu" xPosition="before" class="custom-mat-menu">
                        <div >
                            <div class="clse">
                                <button mat-icon-button class="float-end close-icon-inmenue" (click)="menuTrigger.closeMenu(); $event.stopPropagation()">
                                    <mat-icon >remove</mat-icon>
                                </button>
                            </div>

                            <app-filters (operatorValue)="getOperator($event)" (companyNamevalue)="getCompanyName($event)" (surveyNameValue)="getSurveyName($event)" (surveyTitleValue)="getSurveyTitle($event)" (data)="updateFilterData($event)" (dateForFilter)="getDateforFilter($event)" (resetSearchvalue)="resetSearchvalueinAdmin($event)"></app-filters>
                        </div>
                    </mat-menu>
                </div>
                <div class="col-lg-1 col-sm-12 col-md-12 col-12 my-3 admin-search-by" *ngIf="shouldShowDownloadButton()">
                    <button mat-icon-button (click)="downloadExcel()">
                        <mat-icon class="filter" [ngClass]="{'applied-filter': isFilterApplied}" #tooltip="matTooltip" matTooltipClass="bg-light text-dark border border-info" matTooltip="Download"
                        matTooltipPosition="above">cloud_download</mat-icon>
                    </button>
                </div>
            </div>
        </div>
        <div class="col-lg-2 col-sm-12 col-md-12 col-12 my-3" *ngIf="hasUserRole('Admin') && (!hasUserRole('View User') || loggedUserTypeCheck===1)">
            <div class="add_button text-end">
                <button mat-raised-button (click)="addUser()" routerLinkActive="active" class="bg-greendark text-light"><mat-icon>add</mat-icon> ADD
            USER</button>
            </div>
        </div>
    </div>
</div>
        <!-- table section -->
        <div class="col-sm-12 table_pddng">
            <mat-card>
                <mat-card-content class="example-container" id='table_hght'>
                    <div class=" dashboard_sticky_container"> 
                
                    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)" class="mat-elevation-z8" cdkDropList
                    cdkDropListOrientation="horizontal"
                    (cdkDropListDropped)="drop($event)">
                        <ng-container matColumnDef="Name"  >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Name</th>
                            <td mat-cell *matCellDef="let element" class="admin-column-name">{{element.name}}</td>
                        </ng-container>
                        <!-- role Column -->
                        <ng-container matColumnDef="Role" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Role</th>
                            <td mat-cell *matCellDef="let element">{{element.roleCsv }}</td>
                        </ng-container>
                        <!-- state Column -->
                        <ng-container matColumnDef="State" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>State</th>
                            <td mat-cell *matCellDef="let element">{{element.state}}</td>
                        </ng-container>
                        <!-- phone Column -->
                        <ng-container matColumnDef="Phone" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Phone</th>
                            <td mat-cell *matCellDef="let element" class="admin-column">{{element.mobile | phoneMask}}</td>
                        </ng-container>
                        <!-- email Column -->
                        <ng-container matColumnDef="Email" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Email</th>
                            <td mat-cell *matCellDef="let element">{{element.emailAddress}}</td>
                        </ng-container>
                        <!-- Type Column -->
                        <ng-container matColumnDef="User type" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>User Type</th>
                            <td mat-cell *matCellDef="let element">{{element.userType}}</td>
                        </ng-container>
                        <!-- Status Column -->
                        <ng-container matColumnDef="Status" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Status</th>
                            <td mat-cell *matCellDef="let element">{{element.status}}
                                <mat-icon>dropdown_arrow</mat-icon>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="Profile Status" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Profile Status</th>
                            <td mat-cell *matCellDef="let element">{{element.isLocked? 'Locked': 'Unlocked'}}
                                <mat-icon>dropdown_arrow</mat-icon>
                            </td>
                        </ng-container>
                        <!-- activity Column -->
                        <ng-container matColumnDef="modifiedOn">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Last Activity</th>
                            <td mat-cell *matCellDef="let element">{{element.modifiedOn | date:'MM/dd/yyyy'}}</td>
                        </ng-container>
                        <ng-container matColumnDef="lastLogin">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>Last Login</th>
                            <td mat-cell *matCellDef="let element">{{element.lastLogin | date:'MM/dd/yyyy'}}</td>
                        </ng-container>
                        <!-- action Column -->
                        <ng-container matColumnDef="Action" stickyEnd>
                            <th mat-header-cell *matHeaderCellDef class="align-items-center">Action</th>
                            <td mat-cell *matCellDef="let element">
                                <div class="d-flex align-items-center justify-content-start icon_fs">
                                    <!-- Three-dot button to trigger the menu -->
                                    <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Actions">
                                        <mat-icon>more_vert</mat-icon>
                                    </button>
                                    <!-- Menu with the actions -->
                                    <mat-menu #menu="matMenu">
                                       <div *ngIf="!isView">
                                        <button mat-menu-item (click)="editUser(element)">
                                            <mat-icon>create</mat-icon>
                                            <span>Edit User</span>
                                        </button>
                                        <button mat-menu-item (click)="viewProfile(element)">
                                            <mat-icon>remove_red_eye</mat-icon>
                                            <span>View User</span>
                                        </button>
                                        <button mat-menu-item (click)="deleteUser(element)" *ngIf="!element.roleCsv.includes('Super Admin')">
                                            <mat-icon>delete</mat-icon>
                                            <span>Delete User</span>
                                        </button>
                                        <button mat-menu-item (click)="openDialogeChangeResetPass(element)">
                                            <mat-icon>vpn_key</mat-icon>
                                            <span>Update or Reset Password</span>
                                        </button>
                                        <button mat-menu-item (click)="lockProfile(element)"
                                                *ngIf="element.failedLoginStatus== 'Unlocked' && element.userId != LoggeduserId">
                                            <mat-icon [ngClass]="{'green': element.failedLoginStatus == 'Unlocked'}">lock</mat-icon>
                                            <span>Click to lock</span>
                                        </button>
                                        <button mat-menu-item (click)="unlockProfile(element)"
                                                *ngIf="element.failedLoginStatus== 'Locked'">
                                            <mat-icon [ngClass]="{'red': element.failedLoginStatus == 'Locked'}">lock_open</mat-icon>
                                            <span>Click to unlock</span>
                                        </button>
                                       </div>
                                       <div *ngIf="isView">
                                        <button mat-menu-item *ngIf="isEditable(element.roleCsv)"  (click)="editUser(element)">
                                            <mat-icon>create</mat-icon>
                                            <span>Edit User</span>
                                        </button>
                                        <button mat-menu-item (click)="viewProfile(element)">
                                            <mat-icon>remove_red_eye</mat-icon>
                                            <span>View User</span>
                                        </button>
                                       </div>
                                    </mat-menu>
                                </div>
                            </td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="displayedColumns" sticky></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr>
                        <!-- Row shown when there is no matching data. -->
                        <tr class="mat-row" *matNoDataRow>
                            <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
                        </tr>
                    </table>
                    </div>
                </mat-card-content>
                <mat-paginator #paginator stickyEnd [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25, 100]"   [length]="totalData" aria-label="Select page of users"></mat-paginator>
            </mat-card>
        </div>
    </div>
</div>
