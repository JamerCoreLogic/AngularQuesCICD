<div (click)="$event.stopPropagation()" *ngIf="companyNamesLoaded && surveyTitleLoaded && activeCompaniesLoaded">
    <!-- View-only mode: Show a read-only version of the filter -->
    <div *ngIf="isViewOnlyMode" class="kendo-filter-view-only">
        <kendo-filter #filterReadOnly [value]="value">
            <kendo-filter-field *ngFor="let filterItem of filters" 
                                [field]="filterItem.field" 
                                [title]="filterItem.title!" 
                                [editor]="filterItem.editor" 
                                [operators]="filterItem.operators!">

                                <ng-template kendoFilterValueEditorTemplate let-currentItem *ngIf="isArrayOptionsEmpty(filterItem.field) && filterItem.editor !== 'date'; else originalTemplate">
                                    <kendo-textbox 
                                        [disabled]="true"
                                        [value]="isArray(currentItem.value) ? currentItem.value[0] : currentItem.value">
                                    </kendo-textbox>
                                  </ng-template>
                <ng-template kendoFilterValueEditorTemplate let-currentItem #originalTemplate >
                    <!-- If the editor is 'string', show the kendo-multiselect component -->
                    <kendo-multiselect *ngIf="filterItem.editor === 'string' && (currentItem.operator !== 'eq' && currentItem.operator !== 'neq')"
                    [data]="fieldDataMap[filterItem.field]"
                    [disabled]="true"
                    [ngModel]="getMultiselectValue(currentItem)" [valuePrimitive]="true"
                    [value]="isArray(currentItem.value) === null ? null : (isArray(currentItem.value) ? currentItem.value : [currentItem.value])">
                    </kendo-multiselect>

                    <kendo-dropdownlist  *ngIf="filterItem.editor === 'string' && (currentItem.operator === 'eq' || currentItem.operator === 'neq')"
                    [data]="fieldDataMap[filterItem.field]"
                    [disabled]="true"
                    [value]="isArray(currentItem.value) ? currentItem.value[0] : currentItem.value">
                    </kendo-dropdownlist>
                    
                    <kendo-dropdownlist  *ngIf="filterItem.editor === 'boolean' && (currentItem.operator === 'eq' || currentItem.operator === 'neq')"
                    [data]="fieldDataMap[filterItem.field]"
                    [disabled]="true"
                    [value]="isArray(currentItem.value) ? currentItem.value[0] : currentItem.value">
                    </kendo-dropdownlist>

                    <kendo-datepicker calendarType="classic" #datepicker *ngIf="filterItem.editor === 'date'" 
                    [disabled]="true"
                    [ngModel]="getDateValue(currentItem)"
                    [value]="getDateValue(currentItem)">
                    </kendo-datepicker>
                </ng-template>
            </kendo-filter-field>
        </kendo-filter>                           
    </div>

    <!-- Edit mode: Show the interactive filter -->
    <div *ngIf="!isViewOnlyMode">
        <kendo-filter #filter [value]="value" (valueChange)="filterFn(filter.value)">
            <kendo-filter-field *ngFor="let filterItem of filters" 
                                [field]="filterItem.field" 
                                [title]="filterItem.title!" 
                                [editor]="filterItem.editor" 
                                [operators]="filterItem.operators!">

                                <ng-template kendoFilterValueEditorTemplate let-currentItem *ngIf="isArrayOptionsEmpty(filterItem.field) && filterItem.editor !== 'date'; else originalTemplate">
                                    <kendo-textbox 
                                        (valueChange)="onChangeForMultiselect($event,currentItem)" 
                                        (filterChange)="handleFilterChange($event,filterItem.field)"
                                        [disabled]="isOperatorEmptyOrNotEmpty(currentItem)"
                                        [value]="isArray(currentItem.value) ? currentItem.value[0] : currentItem.value">
                                    </kendo-textbox>
                                  </ng-template>
                <ng-template kendoFilterValueEditorTemplate let-currentItem #originalTemplate >
                    <!-- If the editor is 'string', show the kendo-multiselect component -->
                    <kendo-multiselect *ngIf="filterItem.editor === 'string' && (currentItem.operator !== 'eq' && currentItem.operator !== 'neq')"
                    [data]="fieldDataMap[filterItem.field]"
                    [filterable]="true"
                    (valueChange)="onChangeForMultiselect($event,currentItem)" 
                    (filterChange)="handleFilterChange($event,filterItem.field)"
                    [disabled]="isOperatorEmptyOrNotEmpty(currentItem)"
                    [ngModel]="getMultiselectValue(currentItem)" [valuePrimitive]="true"
                    [value]="isArray(currentItem.value) === null ? null : (isArray(currentItem.value) ? currentItem.value : [currentItem.value])">
                    </kendo-multiselect>

                    <kendo-dropdownlist  *ngIf="filterItem.editor === 'string' && (currentItem.operator === 'eq' || currentItem.operator === 'neq')"
                    [data]="fieldDataMap[filterItem.field]"
                    [filterable]="true"
                    (valueChange)="onChangeForSingleValue($event,currentItem)" 
                    (filterChange)="handleFilterChange($event,filterItem.field)"
                    [disabled]="isOperatorEmptyOrNotEmpty(currentItem)"
                    [value]="isArray(currentItem.value) ? currentItem.value[0] : currentItem.value">
                    </kendo-dropdownlist>
                    
                    <kendo-dropdownlist  *ngIf="filterItem.editor === 'boolean' && (currentItem.operator === 'eq' || currentItem.operator === 'neq')"
                    [data]="fieldDataMap[filterItem.field]"
                    [filterable]="false"
                    (valueChange)="onChangeForMultiselect($event,currentItem)" 
                    (filterChange)="handleFilterChange($event,filterItem.field)"
                    [disabled]="isOperatorEmptyOrNotEmpty(currentItem)"
                    [value]="isArray(currentItem.value) ? currentItem.value[0] : currentItem.value">
                    </kendo-dropdownlist>

                    <kendo-datepicker calendarType="classic" #datepicker *ngIf="filterItem.editor === 'date'" 
                    (valueChange)="onChangeForMultiselect($event,currentItem)" 
                    (filterChange)="handleFilterChange($event,filterItem.field)"
                    [disabled]="isOperatorEmptyOrNotEmpty(currentItem)"
                    [ngModel]="getDateValue(currentItem)"
                    [value]="getDateValue(currentItem)">
                    </kendo-datepicker>
                </ng-template>
            </kendo-filter-field>
        </kendo-filter>
    </div>                        
</div>
<div>
    
</div>
<div class="filter-btn-space" >
    <button mat-raised-button  class="out_grn-dark text-light" (click)="initializeValue()">Reset</button>
    <button mat-raised-button *ngIf="!hideActionButtons && !isViewOnlyMode"  class="bg-greendark text-light text-light" (click)="applyfiltersManual()">Apply</button>
</div>